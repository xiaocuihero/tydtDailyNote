<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/app.css" />
		<style>
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			
			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}
			
			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}
			
			.oa-contact-avatar {
				width: 75px;
			}
			
			.oa-contact-avatar img {
				border-radius: 50%;
			}
			
			.oa-contact-content {
				width: 100%;
			}
			
			.oa-contact-name {
				margin-right: 20px;
			}
			
			.oa-contact-name,
			oa-contact-position {
				float: left;
			}
			
			ul {
				font-size: 14px;
				color: #8f8f94;
			}
			
			.mui-btn {
				padding: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;">
			<h1 class="mui-title"><span id='account'></span></h1>
			<!--<button id='today' class=" mui-pull-right mui-btn-link">今天<span class="mui-icon mui-icon-arrowright"></span></button>-->
			<button  id='today' type="button" class="mui-right  mui-btn  mui-btn-link mui-btn-nav mui-pull-right">
					今天<span class="mui-icon mui-icon-arrowright"></span>
			</button>
			<a id="setting" class="mui-icon mui-icon-gear mui-pull-left" style="color: #999;"></a>
		</header>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="#tabbar">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-chat">
				<span class="mui-icon mui-icon-email"><span class="mui-badge">2</span></span>
				<span class="mui-tab-label">消息</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-contact">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">通讯录</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-map">
				<span class="mui-icon mui-icon-help"></span>
				<span class="mui-tab-label">（预留）</span>
			</a>
		</nav>
		<br />
		<div class="mui-content">
			<div id="tabbar" class="mui-control-content mui-active">
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>项目状态</label>
						<select id="prostatus" class="mui-btn mui-btn-block " style="width: auto;" dir="ltr" onChange="SearchPro()">
							<option selected value=" 1 ">正在进行</option>
							<option value="4 ">全部</option>
							<option value="2 ">已完结</option>
							<option value="3 ">暂停</option>
						</select>
					</div>
					<div class="mui-input-row ">
						<label>参与状态</label>
						<select id="stastatus" class="mui-btn mui-btn-block " style="width: auto;" dir="rtl" onChange="SearchPro()">
							<option selected value="0">参与</option>
							<option value="1">全部</option>
							<option value="2">未参与</option>
						</select>
					</div>
					<div class="mui-input-row ">
						<label>个人日志</label>
						<select id="reporttype" class="mui-btn mui-btn-block " style="width: auto;" dir="rtl" onChange="SearchPro()">
							<option selected value="0">个人日志</option>
							<option value="1">项目报告</option>
						</select>
					</div>
					<div class="mui-input-row ">
						<label>项目列表</label>
						<select id="prolist" class="mui-btn mui-btn-block " style="width: 60%;" dir="rtl">
						</select>
					</div>

				</form>
				<br />
				<button type="button" class="mui-btn mui-btn-primary mui-btn-block" onClick="webto()">添  加</button>
			</div>
			<div id="tabbar-with-chat" class="mui-control-content">

				<ul class="mui-table-view mui-table-view-chevron">
					<li class="mui-table-view-cell">
						<a href="" class="mui-navigate-right">Item 1</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="" class="mui-navigate-right">Item 2</a>
					</li>

				</ul>

			</div>
			<div id="tabbar-with-contact" class="mui-control-content">
				<ul class="mui-table-view mui-table-view-striped mui-table-view-condensed">
					<li class="mui-table-view-cell">
						<div class="mui-slider-cell">
							<div class="oa-contact-cell mui-table">
								<div class="oa-contact-avatar mui-table-cell">
									<img src="../images/60x60.gif" />
								</div>
								<div class="oa-contact-content mui-table-cell">
									<div class="mui-clearfix">
										<h4 class="oa-contact-name">张三</h4>
										<span class="oa-contact-position mui-h6">经理</span>
									</div>
									<p class="oa-contact-email mui-h6">
										123456@qq.com
									</p>
								</div>
							</div>
						</div>
					</li>

				</ul>
			</div>
			<div id="tabbar-with-map" class="mui-control-content">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right">
							预留
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right">
							预留
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right">
							预留
						</a>
					</li>
				</ul>
				<ul class="mui-table-view" style="margin-top: 25px;">
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right">
							预留
						</a>
					</li>
				</ul>
				<ul class="mui-table-view" style="margin-top: 25px;">
					<li class="mui-table-view-cell">
						<a style="text-align: center;color: #FF3B30;">
							预留
						</a>
					</li>
				</ul>
			</div>
		</div>
		<script src="js/mui.min.js "></script>
		<script src="js/app.js "></script>
		<script src='./libs/easymob-webim-sdk/jquery-1.11.1.js'></script>
		<script src="./js/main.js"></script>
		<script>
			(function($, doc) {
				$.init();
				$.plusReady(function() {

					var settingPage = $.preload({
						"id ": 'setting',
						"url ": 'setting.html'
					});
					//设置
					var settingButton = $('#setting')[0];
					settingButton.addEventListener('tap', function() {
						mui.openWindow({
							url: 'setting.html',
							id: 'setting',
							//createNew: true,
							show: {
								aniShow: 'slide-in-left'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: false
							}
						});

					}, false);
					//今天
					var gotaday = $('#today')[0];
					gotaday.addEventListener('tap', function() {
						mui.openWindow({
							url: 'today.html',
							id: 'today',
							createNew: true,
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: false
							}
						});

					}, false);
					//--
					$.oldBack = mui.back;
					var backButtonPress = 0;
					$.back = function(event) {
						backButtonPress++;
						if(backButtonPress > 1) {
							plus.runtime.quit();
						} else {
							plus.nativeUI.toast('再按一次退出应用');
						}
						setTimeout(function() {
							backButtonPress = 0;
						}, 1000);
						return false;
					};
				});
			}(mui, document));

			//业务部分
			var settings = app.getSettings();
			var state = app.getState();
			jQuery('#account').html(state.name);
			SearchPro();

			function webto() {
				var projectid = jQuery("#prolist").val();
				var projectname = jQuery("#prolist").find("option:selected").text();
				var isreport = jQuery("#reporttype").val();
				if(projectid != null && projectid != "") {
					if(isreport == 0) //个人日志
					{
						mui.openWindow({
							url: 'StaffCalendar.html',
							id: 'StaffCalendar',
							createNew: true,
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: false
							},
							extras: {
								projectname: projectname,
								projectid: projectid
								
							}
						});

					}
					//项目报告
					else {
						mui.alert("待开发");

					}

				}
			}

			function SearchPro() //查找项目，并填充列表
			{
				var userid = state.id;
				var prostatus = jQuery("#prostatus").val();
				var stastatus = jQuery("#stastatus").val();
				var reporttype = jQuery("#reporttype").val();
				var url = "http://114.215.94.229/tydtdailynotephp/searchpro.php";
				var jprolist = jQuery("#prolist");

				var data = {
					userid: userid,
					prostatus: prostatus,
					stastatus: stastatus,
					reporttype: reporttype
				};
				mui.ajax(url, {
					data: data,
					dataType: 'text', //服务器返回json格式数据  
					type: 'POST', //HTTP请求类型  
					timeout: 10000, //超时时间设置为10秒；  
					success: function(data) {
						jprolist.empty();
						var msgg = data.split(";");
						var msggg;
						for(var i = 0; i < msgg.length - 1; i++) {
							msggg = msgg[i].split(",");
							jprolist.append("<option value='" + msggg[0] + "'>" + msggg[1] + "</option>");
						}
					},
					error: function(xhr, type, errorThrown) {
						return;

					}
				});
			}

		</script>
	</body>

</html>